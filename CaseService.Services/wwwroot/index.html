<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link href="css/dashboard.css" rel="stylesheet">
        <link href="css/loading.css" rel="stylesheet">
        <link href="css/codemirror.css" rel="stylesheet">
        <link href="css/show-hint.css" rel="stylesheet">
        <link href="css/ambiance.css" rel="stylesheet">

        <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        <script src="js/lib/codemirror.js"></script>
        <script src="js/lib/matchbrackets.js"></script>
        <script src="js/lib/sql.js"></script>
        <script src="js/lib/show-hint.js"></script>
        <script src="js/lib/sql-hint.js"></script>
        <script src="js/lib/autorefresh.js"></script>

        <title>Case Service</title>
    </head>
    <body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
        <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Roche</a>
        <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">
        <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
            <a class="nav-link" href="#">Sign out</a>
        </li>
        </ul>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-2 d-none d-md-block bg-light sidebar">
                <div class="sidebar-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item">
                    <a class="nav-link" href="#dashboard">
                        <span data-feather="home"></span>
                        Dashboard <span class="sr-only">(current)</span>
                    </a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="#create-case">
                        <span data-feather="file"></span>
                        Create Case
                    </a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="#list-cases">
                        <span data-feather="list"></span>
                        List Cases
                    </a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="#create-report">
                        <span data-feather="bar-chart-2"></span>
                        Reports
                    </a>
                    </li>

                </ul>

                <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                    <span>Saved reports</span>
                    <a class="d-flex align-items-center text-muted" href="#">
                    <span data-feather="plus-circle"></span>
                    </a>
                </h6>
                <ul class="nav flex-column mb-2">
                    <li class="nav-item">
                    <a class="nav-link" href="#">
                        <span data-feather="file-text"></span>
                        Current month
                    </a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="#">
                        <span data-feather="file-text"></span>
                        Last quarter
                    </a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="#">
                        <span data-feather="file-text"></span>
                        Social engagement
                    </a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="#">
                        <span data-feather="file-text"></span>
                        Year-end sale
                    </a>
                    </li>
                </ul>
                </div>
            </nav>
            <main role="main" id="loading" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
                <div id="preloader">
                    <div id="loader"></div>
                </div>
            </main>
            <main id="dashboard" style="display:none;" role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
                <h1 class="h2">Dashboard</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group mr-2">
                    <button class="btn btn-sm btn-outline-secondary">Share</button>
                    <button class="btn btn-sm btn-outline-secondary">Export</button>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle">
                    <span data-feather="calendar"></span>
                    This week
                    </button>
                </div>
                </div>

                <canvas class="my-4" id="myChart" width="900" height="380"></canvas>

                <h2>Section title</h2>
                <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Header</th>
                        <th>Header</th>
                        <th>Header</th>
                        <th>Header</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>1,001</td>
                        <td>Lorem</td>
                        <td>ipsum</td>
                        <td>dolor</td>
                        <td>sit</td>
                    </tr>
                    <tr>
                        <td>1,002</td>
                        <td>amet</td>
                        <td>consectetur</td>
                        <td>adipiscing</td>
                        <td>elit</td>
                    </tr>
                    <tr>
                        <td>1,003</td>
                        <td>Integer</td>
                        <td>nec</td>
                        <td>odio</td>
                        <td>Praesent</td>
                    </tr>
                    <tr>
                        <td>1,003</td>
                        <td>libero</td>
                        <td>Sed</td>
                        <td>cursus</td>
                        <td>ante</td>
                    </tr>
                    <tr>
                        <td>1,004</td>
                        <td>dapibus</td>
                        <td>diam</td>
                        <td>Sed</td>
                        <td>nisi</td>
                    </tr>
                    <tr>
                        <td>1,005</td>
                        <td>Nulla</td>
                        <td>quis</td>
                        <td>sem</td>
                        <td>at</td>
                    </tr>
                    <tr>
                        <td>1,006</td>
                        <td>nibh</td>
                        <td>elementum</td>
                        <td>imperdiet</td>
                        <td>Duis</td>
                    </tr>
                    <tr>
                        <td>1,007</td>
                        <td>sagittis</td>
                        <td>ipsum</td>
                        <td>Praesent</td>
                        <td>mauris</td>
                    </tr>
                    <tr>
                        <td>1,008</td>
                        <td>Fusce</td>
                        <td>nec</td>
                        <td>tellus</td>
                        <td>sed</td>
                    </tr>
                    <tr>
                        <td>1,009</td>
                        <td>augue</td>
                        <td>semper</td>
                        <td>porta</td>
                        <td>Mauris</td>
                    </tr>
                    <tr>
                        <td>1,010</td>
                        <td>massa</td>
                        <td>Vestibulum</td>
                        <td>lacinia</td>
                        <td>arcu</td>
                    </tr>
                    <tr>
                        <td>1,011</td>
                        <td>eget</td>
                        <td>nulla</td>
                        <td>Class</td>
                        <td>aptent</td>
                    </tr>
                    <tr>
                        <td>1,012</td>
                        <td>taciti</td>
                        <td>sociosqu</td>
                        <td>ad</td>
                        <td>litora</td>
                    </tr>
                    <tr>
                        <td>1,013</td>
                        <td>torquent</td>
                        <td>per</td>
                        <td>conubia</td>
                        <td>nostra</td>
                    </tr>
                    <tr>
                        <td>1,014</td>
                        <td>per</td>
                        <td>inceptos</td>
                        <td>himenaeos</td>
                        <td>Curabitur</td>
                    </tr>
                    <tr>
                        <td>1,015</td>
                        <td>sodales</td>
                        <td>ligula</td>
                        <td>in</td>
                        <td>libero</td>
                    </tr>
                    </tbody>
                </table>
                </div>
            </main>
            <main style="display:none;" id="create-case" role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
                <div class="row">
                    <div class="col-md-10 mx-auto">
                        <form>
                            <h1>Create Case</h1>
                            <hr>
                            <h2>Patient Information</h2>
                            <hr>
                            <div id="patient">
                                <div class="form-group row">
                                    <div class="col-sm-6">
                                        <label for="PatientFirstName-Prot">First name</label>
                                        <input type="text" class="form-control" id="PatientFirstName-Prot" placeholder="First name">
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="PatientLastName-Prot">Last name</label>
                                        <input type="text" class="form-control" id="PatientLastName-Prot" placeholder="Last name">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-sm-6">
                                        <label for="AccessionID">AccessionID</label>
                                        <input type="text" class="form-control" id="AccessionID" placeholder="AccessionID">
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="PatientId">PatientId</label>
                                        <input type="text" class="form-control" id="PatientId" placeholder="PatientId">
                                    </div>
                                </div>
                            </div>
                            <h2>Requestor Information</h2>
                            <hr>
                            <div id="requestor">
                                <div class="form-group row">
                                    <div class="col-sm-6">
                                        <label for="RequestorFirstName-Prot">First name</label>
                                        <input type="text" class="form-control" id="RequestorFirstName-Prot" placeholder="First name">
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="RequestorLastName-Prot">Last name</label>
                                        <input type="text" class="form-control" id="RequestorLastName-Prot" placeholder="Last name">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-sm-6">
                                        <label for="Email">Email</label>
                                        <input type="text" class="form-control" id="Email" placeholder="Email">
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="Mobile">Mobile</label>
                                        <input type="text" class="form-control" id="Mobile" placeholder="Mobile">
                                    </div>
                                </div>
                            </div>
                            <h2>Add Specimen</h2>
                            <hr>
                            <div id="add-specimens">
                                <div class="form-group row">
                                    <div class="col-sm-3">
                                        <label for="SpecimenId-Prot">SpecimenId</label>
                                        <input type="text" class="form-control" id="SpecimenId-Prot" placeholder="SpecimenId">
                                    </div>
                                    <div class="col-sm-3">
                                            <label for="BlockId-Prot">BlockId</label>
                                            <input type="text" class="form-control" id="BlockId-Prot" placeholder="BlockId">
                                    </div>
                                    <div class="col-sm-3">
                                        <label for="SlideId-Prot">SlideId</label>
                                        <input type="text" class="form-control" id="SlideId-Prot" placeholder="SlideId">
                                    </div>
                                    <div class="col-sm-3">
                                        <label for="ProtocolNumber-Prot">ProtocolNumber</label>
                                        <input type="text" class="form-control" id="ProtocolNumber-Prot" placeholder="ProtocolNumber">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-sm-3">
                                        <label for="ProtocolName-Prot">ProtocolName</label>
                                        <input type="text" class="form-control" id="ProtocolName-Prot" placeholder="ProtocolName">
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="ProtocolDescription-Prot">ProtocolDescription</label>
                                        <input type="text" class="form-control" id="ProtocolDescription-Prot" placeholder="ProtocolDescription">
                                    </div>
                                    <div class="col-sm-3">
                                        <button id="add_specimen" type="button" class="btn btn-primary px-4" style="margin-top: 28px;">Add</button>
                                    </div>
                                </div>
                            </div>
                            <h2>Specimens</h2>
                            <hr>
                            <div id="specimens">
                                <div class="table-responsive">
                                    <table id="specimen_table" class="table table-striped table-sm">
                                        <thead>
                                        <tr>
                                            <th>SpecimenId</th>
                                            <th>BlockId</th>
                                            <th>SlideId</th>
                                            <th>ProtocolNumber</th>
                                            <th>ProtocolName</th>
                                            <th>ProtocolDescription</th>
                                            <th>Delete</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <button id="save_case" type="button" class="btn btn-primary px-4 float-right">Save</button>
                        </form>
                    </div>
                </div>
            </main>
            <main style="display:none;" id="view-case" role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
                <div class="row">
                    <div class="col-md-10 mx-auto">
                        <h1>View Case</h1>
                        ID: <span id="view_case_id"></span>
                        <hr>
                        <div id="view_patient">
                            <div class="row">
                                <div class="col-sm-6">
                                    <h2>Patient Information</h2>
                                </div>
                                <div class="col-sm-6">
                                    <h2>Requestor Information</h2>
                                </div>
                            </div>
                            <div class="row">
                                    <div class="col-sm-6">
                                        System ID: <span id="patient_system_id"></span>
                                    </div>
                                    <div class="col-sm-6">
                                        System ID: <span id="requestor_system_id"></span>
                                    </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    First Name: <span id="patient_first_name"></span>
                                </div>
                                <div class="col-sm-6">
                                    First Name: <span id="requestor_first_name"></span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    Last Name: <span id="patient_last_name"></span>
                                </div>
                                <div class="col-sm-6">
                                    Last Name: <span id="requestor_last_name"></span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    Accession ID: <span id="patient_accession_id"></span>
                                </div>
                                <div class="col-sm-6">
                                    Email: <span id="requestor_email"></span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    Patient ID: <span id="patient_id"></span>
                                </div>
                                <div class="col-sm-6">
                                    Mobile: <span id="requestor_mobile"></span>
                                </div>
                            </div>
                            <br>
                            <h2>Specimens</h2>
                            <div class="table-responsive">
                                <table id="specimen_view_table" class="table table-striped table-sm">
                                    <thead>
                                        <tr>
                                            <th>SpecimenId</th>
                                            <th>BlockId</th>
                                            <th>SlideId</th>
                                            <th>ProtocolNumber</th>
                                            <th>ProtocolName</th>
                                            <th>ProtocolDescription</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>
            </main>
            <main role="main" id="list-cases" style="display:none;" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
                <h1>List All Cases</h1>
                <hr>
                <div class="table-responsive">
                    <table id="all_cases_table" class="table table-striped table-sm">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Requestor</th>
                                <th>Patient</th>
                                <th>View</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </main>
            <main style="display:none;" id="create-report" role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
                <div class="row">
                    <div class="col-md-10 mx-auto">
                        <h1>Create Report</h1>
                        <hr>
                        <div class="row">
                            <div class="col-sm-8">
                                <textarea id="code" name="code" style="width: 90%; height: 90%; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box;">
-- SQL Mode for CodeMirror
SELECT SQL_NO_CACHE DISTINCT
        @var1 AS `val1`, @'val2', @global.'sql_mode',
        1.1 AS `float_val`, .14 AS `another_float`, 0.09e3 AS `int_with_esp`,
        0xFA5 AS `hex`, x'fa5' AS `hex2`, 0b101 AS `bin`, b'101' AS `bin2`,
        DATE '1994-01-01' AS `sql_date`, { T "1994-01-01" } AS `odbc_date`,
        'my string', _utf8'your string', N'her string',
        TRUE, FALSE, UNKNOWN
    FROM DUAL
    -- space needed after '--'
    # 1 line comment
    /* multiline
    comment! */
    LIMIT 1 OFFSET 0;
                                        
                                </textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>



    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
    <script>
        feather.replace()
    </script>

    <!-- Graphs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
    <script>
        var ctx = document.getElementById("myChart");
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
                datasets: [{
                    data: [15339, 21345, 18483, 24003, 23489, 24092, 12034],
                    lineTension: 0,
                    backgroundColor: 'transparent',
                    borderColor: '#007bff',
                    borderWidth: 4,
                    pointBackgroundColor: '#007bff'
                }]
            },
            options: {
                scales: {
                yAxes: [{
                    ticks: {
                    beginAtZero: false
                    }
                }]
                },
                legend: {
                display: false,
                }
            }
        });
        var list_cases_done = false;

        var change_main = function(main_id) {
            console.info("Chainging main to: " + main_id)
            if(!$("[href='" + main_id + "']").hasClass('active')) {
                $('nav a').removeClass('active');
                $("[href='" + main_id + "']").addClass('active');
                $('main').hide(function() {
                    if(main_id === '#list-cases') {
                        if(!list_cases_done) {
                            list_cases();
                        }
                    } else if(main_id === '#create-report') {
                        window.editor.refresh();
                        $(main_id).show();
                    } else {
                        list_cases_done = false;
                        $(main_id).show();
                    }
                });
            }
        }

        var list_cases = function() {
            list_cases_done = true;
            $('main').hide(function() {
                $('#loading').show();
            });
            
            console.info('Listing all cases.');
            if($('#all_cases_table tbody td').length === 0) {
                $.ajax({
                    type: "GET",
                    url: "/api/v1/Case/",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data, status, jqXHR) {
                        var tbody = "";
                        for(var i in data) {
                            var c = data[i];
                            
                            var requestorTd = "";
                            var patientTd = "";

                            if(c.Requestor) {
                                requestorTd = c.Requestor.FirstName + " " + c.Requestor.LastName;
                            }

                            if(c.Patient) {
                                patientTd = c.Patient.FirstName + " " + c.Patient.LastName;
                            }

                            tbody += 
                            "<tr>" +
                                "<td>" + c.Id + "</td>" +
                                "<td>" + requestorTd + "</td>" +
                                "<td>" + patientTd + "</td>" +
                                "<td><a class=\"view_case\" href=\"" + c.Id + "\"><i data-feather=\"eye\"></i></a></td>" +
                                "<td><a class=\"delete_case\" href=\"" + c.Id + "\"><i data-feather=\"delete\"></i></a></td>" +
                            "</tr>";
                        }

                        $('#all_cases_table tbody').html(tbody);
                        feather.replace();
                        $('main').hide(function() {
                            console.warn('list all cases')
                            $('#list-cases').show();
                        });
                    },
                    error: function (jqXHR, status) {
                        // error handler
                        console.log(jqXHR);
                        alert('fail: ' + status.code);
                    }
                }); 
            } else {
                $('main').hide(function() {
                    setTimeout(function() {
                        $('#list-cases').show();
                    }, 1000)
                });
            }
        }

        var view_case = function(case_id) {
            $.ajax({
                type: "GET",
                url: "/api/v1/Case/" + case_id,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data, status, jqXHR) {
                    $('#view_case_id').text(data.Id)

                    if(data.Patient != null) {

                        $('#patient_system_id').text(data.Patient.Id);
                        $('#patient_first_name').text(data.Patient.FirstName);
                        $('#patient_last_name').text(data.Patient.LastName);
                        $('#patient_accession_id').text(data.Patient.AccessionID);
                        $('#patient_id').text(data.Patient.PatientId);
                    }

                    if(data.Requestor != null) {
                        $('#requestor_system_id').text(data.Requestor.Id);
                        $('#requestor_first_name').text(data.Requestor.FirstName);
                        $('#requestor_last_name').text(data.Requestor.LastName);
                        $('#requestor_email').text(data.Requestor.Email);
                        $('#requestor_mobile').text(data.Patient.Mobile);
                    }

                    var tbody = "";
                    var casesCount = 0;
                    for(var i in data.Specimens) {
                        var Specimen = data.Specimens[i];
                        casesCount++;
                        tbody +=
                        "<tr>" +
                            "<td class=\"specimenId\">" + Specimen.Id + "</td>" +
                            "<td class=\"blockId\">" + Specimen.BlockId + "</td>" +
                            "<td class=\"slideId\">" + Specimen.SlideId + "</td>" +
                            "<td class=\"protocolNumber\">" + Specimen.ProtocolNumber + "</td>" +
                            "<td class=\"protocolName\">" + Specimen.ProtocolName + "</td>" +
                            "<td class=\"protocolDescription\">" + Specimen.ProtocolDescription + "</td>" +
                        "</tr>";
                    }

                    $('#specimen_view_table tbody').html(tbody);

                    location.hash = 'view-case';
                },
                error: function (jqXHR, status) {
                    // error handler
                    console.log(jqXHR);
                    alert('fail: ' + status.code);
                }
            });
        }

        $(document).ready(function() {
            setTimeout(function() {
                if(location.hash == '') {
                    location.hash = 'dashboard';
                } else {
                    change_main(location.hash, true);
                }
            }, 2000)

            window.editor = CodeMirror.fromTextArea(document.getElementById('code'), {
                mode: 'text/x-sql',
                indentWithTabs: true,
                smartIndent: true,
                lineNumbers: true,
                matchBrackets : true,
                autofocus: true,
                extraKeys: {"Ctrl-Space": "autocomplete"},
                theme: 'ambiance',
                autorefresh: true,
                hintOptions: {
                    tables: {
                        users: ["name", "score", "birthDate"],
                        countries: ["name", "population", "size"]
                    }
                }
            });

            // setTimeout(function(){
                
            // }, 2000)

            $('#add_specimen').click(function(e){

                var proceed = true;

                if(!$.isNumeric($('#BlockId-Prot').val())) {
                    $('#BlockId-Prot').addClass('is-invalid');
                    $('#BlockId-Prot').parent().append('<div class="invalid-feedback">BlockId needs to have numeric value</div>');
                    proceed = false;
                }

                if(!$.isNumeric($('#ProtocolNumber-Prot').val())) {
                    $('#ProtocolNumber-Prot').addClass('is-invalid');
                    $('#ProtocolNumber-Prot').parent().append('<div class="invalid-feedback">ProtocolNumber needs to have numeric value</div>');
                    proceed = false;
                }

                if(!$.isNumeric($('#SlideId-Prot').val())) {
                    $('#SlideId-Prot').addClass('is-invalid');
                    $('#SlideId-Prot').parent().append('<div class="invalid-feedback">SlideId needs to have numeric value</div>');
                    proceed = false;
                }

                if(proceed) {
                    $('#specimens tbody').append(
                        "<tr>" +
                            "<td class=\"specimenId\">" + $('#SpecimenId-Prot').val() + "</td>" +
                            "<td class=\"blockId\">" + $('#BlockId-Prot').val() + "</td>" +
                            "<td class=\"slideId\">" + $('#SlideId-Prot').val() + "</td>" +
                            "<td class=\"protocolNumber\">" + $('#ProtocolNumber-Prot').val() + "</td>" +
                            "<td class=\"protocolName\">" + $('#ProtocolName-Prot').val() + "</td>" +
                            "<td class=\"protocolDescription\">" + $('#ProtocolDescription-Prot').val() + "</td>" +
                            "<td><a class=\"delete\" href=\"#\"><i data-feather=\"delete\"></i></a></td>" +
                        "</tr>"
                    );
                    feather.replace();
                }
                e.preventDefault();
                return false;
            });

            $('#specimens tbody').on('click', '.delete', function(e) {
                console.info('Removing Specimen.')
                $(this).parent().parent().remove();
                e.preventDefault();
                return false;
            });

            $('#save_case').click(function(e) {
                location.hash = 'loading';

                var patient = {
                    'accessionID': $('#AccessionID').val(),
                    'firstName': $('#PatientFirstName-Prot').val(),
                    'lastName': $('#PatientLastName-Prot').val(),
                    'patientId': $('#PatientLastName-Prot').val()
                }

                var requestor = {
                    'firstName': $('#RequestorFirstName-Prot').val(),
                    'lastName': $('#RequestorLastName-Prot').val(),
                    'email': $('#Email').val(),
                    'mobile': $('#Mobile').val()
                }

                var specimens = [];

                $('#specimen_table tbody tr').each(function(){
                    var specimen = {};
                    $(this).find('td').each(function() {
                        if($(this).attr('class') != undefined) {
                            specimen[$(this).attr('class')] = $(this).text();
                        }
                    })
                    specimens.push(specimen);
                });

                $.ajax({
                    type: "POST",
                    url: "/api/v1/Case",
                    data: JSON.stringify({
                        'patient': patient,
                        'requestor': requestor,
                        'specimens': specimens
                    }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data, status, jqXHR) {
                        $('#create-case input').val('');
                        $('#specimen_table tbody tr').remove();
                        view_case(data.id)
                    },
                    error: function (jqXHR, status) {
                        // error handler
                        console.log(jqXHR);
                        alert('fail' + status.code);
                    }
                });

                e.preventDefault();
                return false;
            });

            $('#all_cases_table tbody').on('click', '.view_case', function(e) {
                location.hash = 'loading';
                view_case($(this).attr('href'));
                e.preventDefault();
                return false;
            })

            $('#all_cases_table tbody').on('click', '.delete_case', function(e) {
                var $this = $(this);
                $.ajax({
                    type: "DELETE",
                    url: "/api/v1/Case/" + $(this).attr('href'),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data, status, jqXHR) {
                        var td = $this.parent().parent();
                        td.fadeOut(function() {
                            td.remove();
                        });
                    },
                    error: function (jqXHR, status) {
                        // error handler
                        console.log(jqXHR);
                        alert('fail: ' + status.code);
                    }
                });

                e.preventDefault();
                return false;
            })
        })

        $(window).on('hashchange', function(e){
            console.info("Hash Change.")
            change_main(location.hash, false)
        });


    </script>
    </body>
</html>